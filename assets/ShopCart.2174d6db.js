import{i as x,p as E,r as $,o as s,c as a,b as t,d as I,k as i,g as T,F as W,f as z,t as u,e as F,u as L,$ as M,q as R}from"./index.ddd01c4b.js";import{_ as G}from"./ShopCheckoutStep.6adfa2d9.js";import{_ as H}from"./DashboardDeleteModal.bae5b905.js";const J={class:"container mx-auto my-8"},K={class:"flex justify-center"},O={class:"flex justify-between w-full mb-8"},P=t("h1",{class:"text-4xl font-bold"},"\u7528\u6236\u8CFC\u7269\u8ECA",-1),Q={class:"btn-group"},U={key:0},X=R('<div class="form-control w-full"><label for="couponCode" class="label"><span class="label-text"> \u512A\u60E0\u5238\u4EE3\u78BC </span></label><input id="couponCode" class="input input-bordered" name="couponCode" type="text" placeholder="\u8ACB\u8F38\u5165\u512A\u60E0\u5238\u4EE3\u78BC\u2026\u2026" required></div><button class="btn" type="submit">\u4F7F\u7528\u512A\u60E0\u5238</button>',2),Y=[X],Z={class:"overflow-x-auto w-full"},tt={key:0,class:"table table-zebra w-full"},et=t("thead",null,[t("tr",null,[t("th",null,"\u54C1\u540D"),t("th",null,"\u6578\u91CF"),t("th",null,"\u55AE\u50F9"),t("th",null,"\u7DE8\u8F2F")])],-1),ot={class:"flex"},nt=["value","disabled","onChange"],lt={key:0},st={key:1},at={key:0},ut=["onClick"],it={key:0},_t={__name:"ShopCart",setup(dt){const d=x("axiosWithAuth"),w=E(),N=x("$loading"),l=$([]),r=$([]);async function c(){const o=N.show();d({method:"get",url:"/cart"}).then(n=>{l.value=n.data.data}).finally(()=>{o.hide()})}function V(o,n=1){r.value=[...r.value,o],d({method:"put",url:`/cart/${o}`,data:{data:{product_id:"cartId",qty:n}}}).then(()=>{c()}).finally(()=>{r.value=r.value.filter(h=>h!==o)})}function q(){l.value.carts.length?w.push({name:"cartInfo"}):L().warning("\u8CFC\u7269\u8ECA\u5167\u5C1A\u7121\u5546\u54C1")}function S(o,n=1){V(o,parseInt(n,10))}function j(o){d({method:"delete",url:`/cart/${o}`}).then(()=>{c()})}function A(o){M.show({component:H,bind:{dashboardItem:{title:o.id}},on:{confirm(){j(o.id)}},slots:{title:"\u522A\u9664\u7522\u54C1"}})}function B(){d({method:"delete",url:"/carts"}).then(o=>{c()})}async function D(o){d({method:"post",url:"/coupon",data:{data:{code:o.couponCode.value}}}).then(n=>{c(),o.reset()})}return c(),(o,n)=>{var h,_,f,p,b,m,v,y;return s(),a("div",J,[t("div",K,[I(G,{"current-step":"1"})]),t("div",O,[P,t("div",Q,[(_=(h=l.value)==null?void 0:h.carts)!=null&&_.length?(s(),a("button",{key:0,type:"button",class:"btn btn-error",onClick:n[0]||(n[0]=e=>B())}," \u6E05\u7A7A\u8CFC\u7269\u8ECA ")):i("",!0),t("button",{class:"btn btn-success",type:"button",onClick:n[1]||(n[1]=e=>q())},"\u7D50\u5E33")])]),(p=(f=l.value)==null?void 0:f.carts)!=null&&p.length?i("",!0):(s(),a("div",U,"\u76EE\u524D\u8CFC\u7269\u8ECA\u5167\u7121\u5546\u54C1")),(m=(b=l.value)==null?void 0:b.carts)!=null&&m.length?(s(),a("form",{key:1,class:"flex items-end gap-2 p-4",onSubmit:n[2]||(n[2]=T(e=>{D(e.target)},["prevent"]))},Y,32)):i("",!0),t("div",Z,[(y=(v=l.value)==null?void 0:v.carts)!=null&&y.length?(s(),a("table",tt,[et,t("tbody",null,[(s(!0),a(W,null,z(l.value.carts,e=>{var C,g;return s(),a("tr",{key:e.id},[t("td",null,u((C=e.product)!=null&&C.title?e.product.title:"\u7121\u7D00\u9304"),1),t("td",ot,[t("input",{type:"number",value:e.qty,min:"1",disabled:r.value.includes(e.id),onChange:k=>{S(e.id,k.target.value)}},null,40,nt),F("/"+u((g=e.product)!=null&&g.unit?e.product.unit:"\u500B"),1)]),t("td",null,[e.total!==e.final_total?(s(),a("del",lt,u(e.total),1)):(s(),a("span",st,u(e.total),1))]),e.total!==e.final_total?(s(),a("td",at,"\u6298\u6263\u50F9\uFF1A"+u(e.final_total),1)):i("",!0),t("td",null,[t("button",{class:"btn btn-error",onClick:k=>A(e)},"\u522A\u9664",8,ut)])])}),128))]),t("tfoot",null,[t("tr",null,[t("td",null,"\u7E3D\u8A08: "+u(l.value.total),1),l.value.total!==l.value.final_total?(s(),a("td",it,"\u6298\u6263\u50F9: "+u(l.value.final_total),1)):i("",!0)])])])):i("",!0)])])}}};export{_t as default};
